!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LingOssUpload=t():e.LingOssUpload=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{c(n.next(e))}catch(e){o(e)}}function s(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(1)),s=o(r(3)),c=o(r(6)),u=r(7),f=function(){function e(e,t){if(void 0===t&&(t={}),this.ossInfo=e,this.options=t,!this.ossAccessId||!this.ossAccessKey)throw new Error("check oss accessId || accessKey")}return Object.defineProperty(e.prototype,"ossAccessId",{get:function(){return this.ossInfo.accessId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ossAccessKey",{get:function(){return this.ossInfo.accessKey},enumerable:!1,configurable:!0}),e.prototype.getPolicyBase64=function(e){var t=[];t.push(["starts-with","$bucket",""]),this.options.rootDir&&t.push(["starts-with","$key",this.options.rootDir]),e&&!Number.isNaN(+e)&&t.push(["content-length-range",0,e]);var r=new Date;r.setDate(r.getDate()+1);var n={expiration:r.toISOString(),conditions:t};return c.default.parse(JSON.stringify(n)).toString(a.default)},e.prototype.getSignature=function(e,t){return s.default(t,e).toString(a.default)},e.prototype.getDirName=function(e){return""==e||e.endsWith("/")?e:e+"/"},e.prototype.getCalculateObjectName=function(e,t){return t?e?"${filename}":""+u.getRandomString():""+u.getRandomString()+u.getSuffix(e)},e.prototype.upload=function(e){var t=e.file,r=e.host,o=e.dirName,a=e.selfName,s=void 0!==a&&a,c=e.limitSize,f=void 0===c?0:c,l=e.limitType,h=void 0===l?"":l,d=e.onProgress,p=void 0===d?function(){return{}}:d,g=e.uploadFile,v=void 0===g?u.ajax:g,m=e.cdnHost,y=void 0===m?r:m,b=e.isCompressor,w=void 0===b||b,x=e.options,_=void 0===x?{}:x;return n(this,void 0,void 0,(function(){var e,n,a,c,l,d;return i(this,(function(i){switch(i.label){case 0:return e=t.name,n=t.size,(a=t.type).startsWith("image")&&w?[4,u.compressorImage(t,_)]:[3,2];case 1:t=i.sent(),i.label=2;case 2:return!h||!a||(!0,"function"==typeof h?h(t):new RegExp(h+"/(\\S)+","gi").test(a))?f&&n&&f<n?[2,Promise.reject({code:400,data:"",message:"最大上传"+f/1024/1024+"M的文件",success:!1})]:(c=this.getDirName(o)+this.getCalculateObjectName(e,s),l=this.getPolicyBase64(f),(d=new FormData).append("name",t.name),d.append("key",c),d.append("policy",l),d.append("OSSAccessKeyId",this.ossAccessId),d.append("success_action_status","200"),d.append("signature",this.getSignature(this.ossAccessKey,l)),d.append("file",t),this.ossInfo.securityToken&&d.append("x-oss-security-token",this.ossInfo.securityToken),[2,new Promise((function(t,n){v(r,d,p).then((function(){t({code:200,data:(y+"/"+c).replace("${filename}",e),message:"上传成功",success:!0})})).catch((function(e){n({code:400,data:"",message:e&&e.message||u.getMessage2Xml(e),success:!1})}))}))]):[2,Promise.reject({code:400,data:"",message:"请检查文件类型",success:!1})]}}))}))},e.prototype.createMiniUploadInfo=function(e){var t=e.dirName,r=e.limitSize,n=void 0===r?0:r,i=e.selfName,o=void 0!==i&&i,a=this.getCalculateObjectName("",o),s=this.getPolicyBase64(n),c=this.getSignature(this.ossAccessKey,s);return{name:a,key:this.getDirName(t)+a,success_action_status:200,OSSAccessKeyId:this.ossAccessId,policy:s,signature:c,"x-oss-security-token":this.ossInfo.securityToken}},e}();t.default=f},function(e,t,r){var n,i,o;e.exports=(o=r(2),i=(n=o).lib.WordArray,n.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],o=0;o<r;o+=3)for(var a=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,s=0;s<4&&o+.75*s<r;s++)i.push(n.charAt(a>>>6*(3-s)&63));var c=n.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var o=0;o<r.length;o++)n[r.charCodeAt(o)]=o}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,r){for(var n=[],o=0,a=0;a<t;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2,c=r[e.charCodeAt(a)]>>>6-a%4*2;n[o>>>2]|=(s|c)<<24-o%4*8,o++}return i.create(n,o)}(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)},function(e,t,r){var n;e.exports=(n=n||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},i=n.lib={},o=i.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=i.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var a=r[o>>>2]>>>24-o%4*8&255;t[n+o>>>2]|=a<<24-(n+o)%4*8}else for(o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],i=function(t){t=t;var r=987654321,n=4294967295;return function(){var i=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},o=0;o<t;o+=4){var s=i(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},c=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},u=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var o=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},f=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},l=i.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,i=r.sigBytes,o=this.blockSize,s=i/(4*o),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var f=0;f<c;f+=o)this._doProcessBlock(n,f);var l=n.splice(0,c);r.sigBytes-=u}return new a.init(l,u)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(i.Hasher=l.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),n)},function(e,t,r){var n;e.exports=(n=r(2),r(4),r(5),n.HmacSHA1)},function(e,t,r){var n,i,o,a,s,c,u,f;e.exports=(f=r(2),i=(n=f).lib,o=i.WordArray,a=i.Hasher,s=n.algo,c=[],u=s.SHA1=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var f=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=f<<1|f>>>31}var l=(n<<5|n>>>27)+s+c[u];l+=u<20?1518500249+(i&o|~i&a):u<40?1859775393+(i^o^a):u<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,s=a,a=o,o=i<<30|i>>>2,i=n,n=l}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+o|0,r[3]=r[3]+a|0,r[4]=r[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=a._createHelper(u),n.HmacSHA1=a._createHmacHelper(u),f.SHA1)},function(e,t,r){var n,i,o,a;e.exports=(n=r(2),o=(i=n).lib.Base,a=i.enc.Utf8,void(i.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,c=o.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},function(e,t,r){var n;e.exports=(n=r(2),n.enc.Utf8)},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ajax=t.getSuffix=t.getRandomString=t.getMessage2Xml=t.compressorImage=void 0;var o=i(r(8));t.compressorImage=function(e,t){return void 0===t&&(t={}),new Promise((function(r){new o.default(e,n(n({},t),{success:function(t){if(t instanceof File)r(t);else{var n=new File([t],e.name,{type:e.type,lastModified:e.lastModified});r(n)}},error:function(t){console.log(t.message),r(e)}}))}))},t.getMessage2Xml=function(e,t){return void 0===t&&(t="上传失败"),window.DOMParser&&(t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Message")[0].textContent||t),t},t.getRandomString=function(e){void 0===e&&(e=32);for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",r="",n=0;n<e;n++)r+=t.charAt(Math.floor(Math.random()*t.length));return r},t.getSuffix=function(e){var t=e.lastIndexOf(".");return~t?e.substring(t):""},t.ajax=function(e,t,r){return new Promise((function(n,i){var o=new XMLHttpRequest;o.upload.onprogress=function(e){e.lengthComputable&&r(e)},o.onload=function(){200===o.status?n(o.responseText):i(o.responseText)},o.open("POST",e,!0),o.send(t)}))}},function(e,t,r){
/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */
e.exports=function(){"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){n(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function n(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function o(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var a={exports:{}};!function(e){"undefined"!=typeof window&&function(t){var r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,n=t.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),i=n&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),o=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,a=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(n||o)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(e){var t,r,s,c,u,f,l,h,d;if(!(t=e.match(a)))throw new Error("invalid data URI");for(r=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),s=!!t[4],c=e.slice(t[0].length),u=s?atob(c):decodeURIComponent(c),f=new ArrayBuffer(u.length),l=new Uint8Array(f),h=0;h<u.length;h+=1)l[h]=u.charCodeAt(h);return n?new Blob([i?l:f],{type:r}):((d=new o).append(f),d.getBlob(r))};t.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(e,t,n){var i=this;setTimeout((function(){n&&r.toDataURL&&s?e(s(i.toDataURL(t,n))):e(i.mozGetAsFile("blob",t))}))}:r.toDataURL&&s&&(r.msToBlob?r.toBlob=function(e,t,n){var i=this;setTimeout((function(){(t&&"image/png"!==t||n)&&r.toDataURL&&s?e(s(i.toDataURL(t,n))):e(i.msToBlob(t))}))}:r.toBlob=function(e,t,r){var n=this;setTimeout((function(){e(s(n.toDataURL(t,r)))}))})),e.exports?e.exports=s:t.dataURLtoBlob=s}(window)}(a);var s=a.exports,c={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},u="undefined"!=typeof window&&void 0!==window.document?window:{},f=function(e){return e>0&&e<1/0},l=Array.prototype.slice;function h(e){return Array.from?Array.from(e):l.call(e)}var d=/^image\/.+$/;function p(e){return d.test(e)}var g=String.fromCharCode,v=u.btoa;function m(e,t){for(var r=[],n=new Uint8Array(e);n.length>0;)r.push(g.apply(null,h(n.subarray(0,8192)))),n=n.subarray(8192);return"data:".concat(t,";base64,").concat(v(r.join("")))}function y(e){var t,r=new DataView(e);try{var n,i,o;if(255===r.getUint8(0)&&216===r.getUint8(1))for(var a=r.byteLength,s=2;s+1<a;){if(255===r.getUint8(s)&&225===r.getUint8(s+1)){i=s;break}s+=1}if(i){var c=i+10;if("Exif"===function(e,t,r){var n,i="";for(r+=t,n=t;n<r;n+=1)i+=g(e.getUint8(n));return i}(r,i+4,4)){var u=r.getUint16(c);if(((n=18761===u)||19789===u)&&42===r.getUint16(c+2,n)){var f=r.getUint32(c+4,n);f>=8&&(o=c+f)}}}if(o){var l,h,d=r.getUint16(o,n);for(h=0;h<d;h+=1)if(l=o+12*h+2,274===r.getUint16(l,n)){l+=8,t=r.getUint16(l,n),r.setUint16(l,1,n);break}}}catch(e){t=1}return t}var b=/\.\d*(?:0|9){12}\d*$/;function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return b.test(e)?Math.round(e*t)/t:e}function x(e){var t=e.aspectRatio,r=e.height,n=e.width,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",o=f(n),a=f(r);if(o&&a){var s=r*t;("contain"===i||"none"===i)&&s>n||"cover"===i&&s<n?r=n/t:n=r*t}else o?r=n/t:a&&(n=r*t);return{width:n,height:r}}var _=u.ArrayBuffer,B=u.FileReader,O=u.URL||u.webkitURL,S=/\.\w+$/,j=u.Compressor;return function(){function e(r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.file=r,this.exif=[],this.image=new Image,this.options=t(t({},c),n),this.aborted=!1,this.result=null,this.init()}var n,o,a;return n=e,a=[{key:"noConflict",value:function(){return window.Compressor=j,e}},{key:"setDefaults",value:function(e){i(c,e)}}],(o=[{key:"init",value:function(){var e=this,t=this.file,r=this.options;if(n=t,"undefined"!=typeof Blob&&(n instanceof Blob||"[object Blob]"===Object.prototype.toString.call(n))){var n,o=t.type;if(p(o))if(O&&B){_||(r.checkOrientation=!1,r.retainExif=!1);var a="image/jpeg"===o,s=a&&r.checkOrientation,c=a&&r.retainExif;if(!O||s||c){var u=new B;this.reader=u,u.onload=function(r){var n=r.target.result,a={},u=1;s&&(u=y(n))>1&&i(a,function(e){var t=0,r=1,n=1;switch(e){case 2:r=-1;break;case 3:t=-180;break;case 4:n=-1;break;case 5:t=90,n=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:n}}(u)),c&&(e.exif=function(e){for(var t=h(new Uint8Array(e)),r=t.length,n=[],i=0;i+3<r;){var o=t[i],a=t[i+1];if(255===o&&218===a)break;if(255===o&&216===a)i+=2;else{var s=i+(256*t[i+2]+t[i+3])+2,c=t.slice(i,s);n.push(c),i=s}}return n.reduce((function(e,t){return 255===t[0]&&225===t[1]?e.concat(t):e}),[])}(n)),a.url=s||c?!O||u>1?m(n,o):O.createObjectURL(t):n,e.load(a)},u.onabort=function(){e.fail(new Error("Aborted to read the image with FileReader."))},u.onerror=function(){e.fail(new Error("Failed to read the image with FileReader."))},u.onloadend=function(){e.reader=null},s||c?u.readAsArrayBuffer(t):u.readAsDataURL(t)}else this.load({url:O.createObjectURL(t)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(e){var r=this,n=this.file,i=this.image;i.onload=function(){r.draw(t(t({},e),{},{naturalWidth:i.naturalWidth,naturalHeight:i.naturalHeight}))},i.onabort=function(){r.fail(new Error("Aborted to load the image."))},i.onerror=function(){r.fail(new Error("Failed to load the image."))},u.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(u.navigator.userAgent)&&(i.crossOrigin="anonymous"),i.alt=n.name,i.src=e.url}},{key:"draw",value:function(e){var t=this,r=e.naturalWidth,n=e.naturalHeight,i=e.rotate,o=void 0===i?0:i,a=e.scaleX,c=void 0===a?1:a,u=e.scaleY,l=void 0===u?1:u,d=this.file,g=this.image,v=this.options,y=document.createElement("canvas"),b=y.getContext("2d"),_=Math.abs(o)%180==90,O=("contain"===v.resize||"cover"===v.resize)&&f(v.width)&&f(v.height),S=Math.max(v.maxWidth,0)||1/0,j=Math.max(v.maxHeight,0)||1/0,A=Math.max(v.minWidth,0)||0,M=Math.max(v.minHeight,0)||0,P=r/n,U=v.width,k=v.height;if(_){var T=[j,S];S=T[0],j=T[1];var R=[M,A];A=R[0],M=R[1];var D=[k,U];U=D[0],k=D[1]}O&&(P=U/k);var H=x({aspectRatio:P,width:S,height:j},"contain");S=H.width,j=H.height;var z=x({aspectRatio:P,width:A,height:M},"cover");if(A=z.width,M=z.height,O){var E=x({aspectRatio:P,width:U,height:k},v.resize);U=E.width,k=E.height}else{var I=x({aspectRatio:P,width:U,height:k}),C=I.width;U=void 0===C?r:C;var F=I.height;k=void 0===F?n:F}var L=-(U=Math.floor(w(Math.min(Math.max(U,A),S))))/2,W=-(k=Math.floor(w(Math.min(Math.max(k,M),j))))/2,N=U,K=k,$=[];if(O){var X,q,G,Y,J=x({aspectRatio:P,width:r,height:n},{contain:"cover",cover:"contain"}[v.resize]);G=J.width,Y=J.height,X=(r-G)/2,q=(n-Y)/2,$.push(X,q,G,Y)}if($.push(L,W,N,K),_){var Q=[k,U];U=Q[0],k=Q[1]}y.width=U,y.height=k,p(v.mimeType)||(v.mimeType=d.type);var V="transparent";d.size>v.convertSize&&v.convertTypes.indexOf(v.mimeType)>=0&&(v.mimeType="image/jpeg");var Z="image/jpeg"===v.mimeType;if(Z&&(V="#fff"),b.fillStyle=V,b.fillRect(0,0,U,k),v.beforeDraw&&v.beforeDraw.call(this,b,y),!this.aborted&&(b.save(),b.translate(U/2,k/2),b.rotate(o*Math.PI/180),b.scale(c,l),b.drawImage.apply(b,[g].concat($)),b.restore(),v.drew&&v.drew.call(this,b,y),!this.aborted)){var ee=function(e){if(!t.aborted){var i=function(e){return t.done({naturalWidth:r,naturalHeight:n,result:e})};if(e&&Z&&v.retainExif&&t.exif&&t.exif.length>0){var o=function(e){return i(s(m(function(e,t){var r=h(new Uint8Array(e));if(255!==r[2]||224!==r[3])return e;var n=256*r[4]+r[5],i=[255,216].concat(t,r.slice(4+n));return new Uint8Array(i)}(e,t.exif),v.mimeType)))};if(e.arrayBuffer)e.arrayBuffer().then(o).catch((function(){t.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))}));else{var a=new B;t.reader=a,a.onload=function(e){var t=e.target;o(t.result)},a.onabort=function(){t.fail(new Error("Aborted to read the compressed image with FileReader."))},a.onerror=function(){t.fail(new Error("Failed to read the compressed image with FileReader."))},a.onloadend=function(){t.reader=null},a.readAsArrayBuffer(e)}}else i(e)}};y.toBlob?y.toBlob(ee,v.mimeType,v.quality):ee(s(y.toDataURL(v.mimeType,v.quality)))}}},{key:"done",value:function(e){var t,r,n=e.naturalWidth,i=e.naturalHeight,o=e.result,a=this.file,s=this.image,c=this.options;if(O&&0===s.src.indexOf("blob:")&&O.revokeObjectURL(s.src),o)if(c.strict&&!c.retainExif&&o.size>a.size&&c.mimeType===a.type&&!(c.width>n||c.height>i||c.minWidth>n||c.minHeight>i||c.maxWidth<n||c.maxHeight<i))o=a;else{var u=new Date;o.lastModified=u.getTime(),o.lastModifiedDate=u,o.name=a.name,o.name&&o.type!==a.type&&(o.name=o.name.replace(S,(t=o.type,"jpeg"===(r=p(t)?t.substr(6):"")&&(r="jpg"),".".concat(r))))}else o=a;this.result=o,c.success&&c.success.call(this,o)}},{key:"fail",value:function(e){var t=this.options;if(!t.error)throw e;t.error.call(this,e)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}])&&r(n.prototype,o),a&&r(n,a),Object.defineProperty(n,"prototype",{writable:!1}),e}()}()}]).default}));